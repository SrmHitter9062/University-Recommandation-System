<?php
// Inialize session
session_start();

// Check, if username session is NOT set then this page will jump to login page
if (!isset($_SESSION['username'])) {
        header('Location: index.php');
}

$catagory = array();
$catagory[0] = 'india';
$catagory[1] = 'world';
$catagory[2] = 'technical';
$catagory[3] = 'business';
$catagory[4] = 'sports';
$catagory[5] = 'health';
$catagory[6] = 'science';
$catagory[7] = 'education';
$catagory[8] = 'lifestyle';
$catagory[9] = 'entertainment';

$con = mysql_connect("localhost","root","root");
if (!$con)
  {
  die('Could not connect: ' . mysql_error());
  }
mysql_select_db("news2", $con);
$user_name = $_SESSION['username'];

$result = mysql_query("SELECT * FROM domain where username = '$user_name'");

$row = mysql_fetch_array($result);
$count = 0;
$interest = array();
$final = array();

$x = 0;
$y = 0;
for( $i = 1; $i <= 10; $i ++ )
{
	if( $row[$i] == 1 ) {
		$interest[$x] = $count;
		//echo $count;
		$x ++;
	}
	
	$count ++;
}
//for( $i = 0; $i < sizeof($interest); $i ++ ) echo $interest[$i]." ";
//echo "<br />";
$size = sizeof($interest);
$temp = $size;
$poss = 1;
while( $temp != 0 ) {
	$poss = $poss*2;
	$temp --;
}
for( $i = 1; $i < $poss; $i ++ ){
	$str = decbin($i);
	$str1 = "";
	for( $j = 0; $j < strlen($str); $j ++ ) {
		$temp1 = $size - strlen($str);
		if( $str[$j] == '1' ) {
			$str1 = $str1.$interest[$temp1+$j];
		}
	}
	$final[$y] = $str1;
	$y ++;
}
//for( $i = 0; $i < sizeof($final); $i ++ ) echo $final[$i]." ";
//echo "<br />";
$final1 = array();
$w = 0;
for( $i = $size; $i >= 1; $i -- ) {
	for( $j = 0; $j < sizeof($final); $j ++ ) {
		if( strlen($final[$j]) == $i ) {
			$final1[$w] = $final[$j];
			$w ++;
		}
	}
}
//for( $i = 0; $i < sizeof($final1); $i ++ ) echo $final1[$i]." 

$file = fopen("rules.txt","r");
$rule = array();
$rule = file("rules.txt");
$check = array();
for( $i = 0; $i <= 9; $i ++ ) $check[$i] = 0;
for( $i = 0; $i < sizeof($interest); $i ++ ) $check[$interest[$i]] = 1;
$recommend = array();
$rule1 = array();
$rule2 = array();
$c = 0;
for( $i = 0; $i < sizeof($rule); $i ++ ) {
	$str = $rule[$i];
	$str1 = "";
	$str2 = "";
	$j = 1;
	while( $str[$j] != '>' ) {
		$str1 = $str1.$str[$j];
		$j = $j + 3;
	}
	$j = $j + 2;
	while( $j < strlen($str) - 2 ) {
		$str2 = $str2.$str[$j];
		$j = $j + 3;
	}
	$rule1[$c] = $str1;
	$rule2[$c] = $str2;
	$c ++;
}
$c = 0;
for( $i = 0; $i < sizeof($final1); $i ++ ) {
	for( $k = 0; $k < sizeof($rule1); $k ++ ) {
		if( strlen($final1[$i]) == strlen($rule1[$k]) && $final1[$i] == $rule1[$k] ) {
			for( $z = 0; $z < strlen($rule2[$k]); $z ++ ) {
				if( $check[$rule2[$k][$z]] == 0 ) {
					$recommend[$c] = $rule2[$k][$z];
					$check[$rule2[$k][$z]] = 1;
					$c ++;
				}
			}
			break;
		}
	}
}
//echo "<br />"."<br />";

for( $i = 0; $i < sizeof($recommend); $i ++ ) {
	//echo (string)$recommend[$i]." ";
	$news =  $catagory[$recommend[$i]]." ";
	//echo $catagory[$recommend[$i]]." ";
	$cat = strtoupper($news);
	echo "<font size=2 color='black' > $cat </font>";
	echo "<br />";
	$result1 = mysql_query("SELECT title,link,type_news FROM news_story WHERE type_news ='$news' ORDER BY date DESC LIMIT 2");
	while($row_1 = mysql_fetch_array($result1))
	{
		$title_ = $row_1['title'];
		$link_ = $row_1['link'];
		$catagory_ = $row_1['type_news'];
		//echo  $catagory_;
		//echo strtoupper($catagory_);
		
		echo "<a href='http://localhost/project1/increment.php?x=$link_ &t=$title_ &z=$catagory_'>$title_</a>";
		echo "<br />";
		
 }
echo "<br />";
	
}

mysql_close($con);
?>
